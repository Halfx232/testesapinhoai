<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Jogo do Sapinho: uma aventura divertida com um sapo, desenvolvida com IA. Jogue agora!">
  <meta name="keywords" content="jogo, sapinho, intelig√™ncia artificial, arcade">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jogo do Sapinho</title>
  <link rel="icon" href="https://em-content.zobj.net/thumbs/160/twitter/322/frog_1f438.png" type="image/png">
  <!-- Meta tags Open Graph -->
  <meta property="og:title" content="Jogo do Sapinho">
  <meta property="og:description" content="Uma aventura divertida com um sapo!">
  <meta property="og:image" content="https://sapinho-ai.vercel.app/thumbnail.jpg">
  <meta property="og:url" content="https://sapinho-ai.vercel.app">
  <meta property="og:type" content="website">
  <!-- Meta tags Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://sapinho-ai.vercel.app/thumbnail.jpg">
  <!-- Estilo inline inicial como fallback -->
  <style>
    html:not(.loaded) body { margin: 0; padding: 0; font-family: sans-serif; background: linear-gradient(180deg, #1a1a1a, #2e2e2e); color: #fff; visibility: hidden; }
    #top-bar, #game-container, #test-version, #about-section, #footer { display: none; }
    a { color: white; text-decoration: none; }
    #start-banner, #game-over-banner, #victory-banner { display: none; }
    canvas:not(.ready) { display: none; }
    #top-bar { background: #1b5e20; display: flex; }
  </style>
  <!-- Pr√©-carregar fontes e CSS -->
  <link rel="preload" href="styles-mobile.css?v=17" as="style" media="screen and (max-width: 1023px)" onload="this.rel='stylesheet'">
  <link rel="preload" href="styles-desktop.css?v=6" as="style" media="screen and (min-width: 1024px)" onload="this.rel='stylesheet'">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="stylesheet" href="styles-mobile.css?v=17" media="screen and (max-width: 1023px)">
  <link rel="stylesheet" href="styles-desktop.css?v=6" media="screen and (min-width: 1024px)">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-SEU-ID" crossorigin="anonymous"></script>

</head>
<body>
  <div id="top-bar">
    <button id="menu-toggle" class="fa fa-bars"></button>
    <div class="weather-clock">
      <div id="weather">Previs√£o do Tempo</div>
      <div id="clock">Rel√≥gio</div>
    </div>
    <nav id="nav-menu">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="sobre.html">Sobre</a></li>
        <li><a href="contato.html">Contato</a></li>
        <li><a href="politicas.html">Pol√≠ticas</a></li>
      </ul>
    </nav>
  </div>

  <div id="game-container">
    <div id="top-ad">
      <ins class="adsbygoogle" style="display:block; width:100%; max-width:400px; height:100px; background:#ccc;" data-ad-client="ca-pub-SEU-ID" data-ad-slot="SEU-SLOT-ID-MOBILE-TOP" data-ad-format="horizontal" data-full-width-responsive="false"></ins>
    </div>
    <div id="left-ad">
      <ins class="adsbygoogle" style="display:block; width:300px; height:400px; max-width:300px; max-height:400px; min-width:300px; min-height:400px;" data-ad-client="ca-pub-SEU-ID" data-ad-slot="SEU-SLOT-ID-DESKTOP" data-ad-format="rectangle" data-full-width-responsive="false"></ins>
    </div>
    <canvas id="gameCanvas" width="400" height="200" class="ready"></canvas>
    <div id="right-ad">
      <ins class="adsbygoogle" style="display:block; width:300px; height:400px; max-width:300px; max-height:400px; min-width:300px; min-height:400px;" data-ad-client="ca-pub-SEU-ID" data-ad-slot="SEU-SLOT-ID-DESKTOP" data-ad-format="rectangle" data-full-width-responsive="false"></ins>
    </div>

<div id="start-banner" class="active">
  <h1>Sejam bem-vindos ao Jogo do Sapinho!</h1>
  <p>Pressione qualquer tecla ou toque para iniciar o jogo</p>
</div>

<div id="game-over-banner">
  <h2>Game Over!</h2>
  <p>Sua pontua√ß√£o: <span id="final-score"></span> | Melhor: <span id="high-score"></span></p>
  <button id="restart-button">Reiniciar Jogo</button>
</div>

<div id="victory-banner">
  <h2>Parab√©ns! Voc√™ venceu!</h2>
  <p>Pontua√ß√£o Final: <span id="victory-score"></span> | Melhor: <span id="high-score-victory"></span></p>
  <button id="play-again-button">Jogar Novamente</button>
</div>  </div>

  <div id="test-version">
    <p>Vers√£o de teste do SapinhoAI, desenvolvida com aux√≠lio de intelig√™ncia artificial. Atualiza√ß√µes em breve!</p>
  </div>

  <div id="about-section">
    <h2>Sobre o Jogo do Sapinho</h2>
    <p>O Jogo do Sapinho √© uma aventura divertida desenvolvida com aux√≠lio de intelig√™ncia artificial. Esta √© uma vers√£o de teste, e novas atualiza√ß√µes est√£o a caminho!</p>
  </div>

  <div id="footer">Siga o Sapinho nas redes sociais! <a href="#">Instagram</a> | <a href="#">YouTube</a> | <a href="#">TikTok</a></div>

  <audio id="jumpSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>
  <audio id="failSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
  <audio id="victorySound" src="Victory.mp3"></audio>
  <audio id="backgroundMusic" src="Musicgame.mp3" loop></audio>  <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
  document.documentElement.classList.add('loaded');

  // Adicione aqui (calcula tamanho e posi√ß√£o logo no in√≠cio)
  resizeCanvas();
  positionBanners();

  const canvas = document.getElementById('gameCanvas');
  canvas.classList.add('ready');
  document.getElementById('top-bar').style.display = 'flex';
  document.getElementById('game-container').style.display = 'flex';
  document.getElementById('test-version').style.display = 'block';
  document.getElementById('about-section').style.display = 'block';
  document.getElementById('footer').style.display = 'block';
  // Remover qualquer link de stylesheet no body
  const invalidLinks = document.body.querySelectorAll('link[rel="stylesheet"]');
  invalidLinks.forEach(link => {
    console.warn('Link de stylesheet encontrado no body, removendo:', link);
    link.remove();
  });
});

    window.addEventListener('load', () => {
      window.cookieconsent.initialise({
        "palette": { "popup": { "background": "#1b5e20" }, "button": { "background": "#00ff00" } },
        "content": { "message": "Este site usa cookies para melhorar sua experi√™ncia.", "dismiss": "Entendido", "link": "Saiba mais", "href": "/politicas.html" }
      });

      const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      if (!isMobile) {
        const ads = document.querySelectorAll('#left-ad > ins, #right-ad > ins');
        ads.forEach(ad => {
          if (!ad.closest('#left-ad, #right-ad').classList.contains('loaded')) {
            ad.style.width = '300px';
            ad.style.height = '400px';
            ad.style.maxWidth = '300px';
            ad.style.maxHeight = '400px';
            ad.style.minWidth = '300px';
            ad.style.minHeight = '400px';
            ad.style.overflow = 'hidden';
            (adsbygoogle = window.adsbygoogle || []).push({});
            ad.closest('#left-ad, #right-ad').classList.add('loaded');
          }
        });
        console.log('Banners laterais for√ßados para 300x400px no load (desktop)');
      } else {
        const ads = document.querySelectorAll('#top-ad > ins');
        ads.forEach(ad => {
          if (!ad.closest('#top-ad').classList.contains('loaded')) {
            ad.style.width = '100%';
            ad.style.maxWidth = '400px';
            ad.style.height = '100px';
            ad.style.background = '#ccc';
            try {
              (adsbygoogle = window.adsbygoogle || []).push({});
              console.log('An√∫ncio superior inicializado com sucesso');
              setTimeout(() => {
                if (ad.getAttribute('data-ad-status') === 'filled') {
                  console.log('An√∫ncio superior carregado com sucesso');
                } else {
                  console.warn('An√∫ncio superior n√£o carregado, status:', ad.getAttribute('data-ad-status'));
                  // Opcional: Ocultar #top-ad se n√£o houver an√∫ncio
                  // ad.closest('#top-ad').style.display = 'none';
                }
              }, 2000);
            } catch (e) {
              console.error('Erro ao inicializar an√∫ncio superior:', e);
              // Opcional: Ocultar #top-ad em caso de erro
              // ad.closest('#top-ad').style.display = 'none';
            }
            ad.closest('#top-ad').classList.add('loaded');
          }
        });
        console.log('Banner superior for√ßado para max-width 400x100px no load (mobile)');
      }
    });

    const menuToggle = document.getElementById('menu-toggle');
    const navMenu = document.getElementById('nav-menu');

    function toggleMenu() {
      navMenu.classList.toggle('open');
    }

    if (menuToggle && navMenu) {
      menuToggle.addEventListener('click', toggleMenu);
      const menuLinks = navMenu.querySelectorAll('a');
      menuLinks.forEach(link => {
        link.addEventListener('click', () => {
          navMenu.classList.remove('open');
        });
      });
    }

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const jumpSound = document.getElementById("jumpSound");
    jumpSound.preload = 'auto';
    jumpSound.volume = 0.8;
    const failSound = document.getElementById("failSound");
    const victorySound = document.getElementById("victorySound");
    victorySound.preload = 'auto';
    victorySound.volume = 0.3;
    const backgroundMusic = document.getElementById("backgroundMusic");
    backgroundMusic.preload = 'auto';
    backgroundMusic.volume = 0.5;
    let audioUnlocked = false;  // Flag pra saber se j√° desbloqueamos

    const startBanner = document.getElementById("start-banner");
    const gameOverBanner = document.getElementById("game-over-banner");
    const finalScore = document.getElementById("final-score");
    const restartButton = document.getElementById("restart-button");
    const victoryBanner = document.getElementById("victory-banner");
    const victoryScore = document.getElementById("victory-score");
    const playAgainButton = document.getElementById("play-again-button");

    const fases = ["primavera", "ver√£o", "outono", "inverno"];
    const coresFase = {
      primavera: { fundo: "#dcedc8", chao: "#81c784" },
      ver√£o: { fundo: "#fff9c4", chao: "#fbc02d" },
      outono: { fundo: "#ffe0b2", chao: "#ff8f00" },
      inverno: { fundo: "#e0f7fa", chao: "#4dd0e1" }
    };

    const PONTUACAO_VITORIA = 5000;
    const GRAVIDADE = 1.5;
    const BASE_WIDTH = 800;
    const BASE_HEIGHT = 400;
    let ALTURA_CHAO = isMobile ? 150 : 300;
    const ALTURA_SAPO = 40;
    const ESPESSURA_CHAO = isMobile ? 20 : 50;
    const SAPO_OFFSET_VISUAL = 47;
    let scaleX = 1;
    let scaleY = 1;

    let gameStarted = false;
    let sapo, obstaculos = [], tempo, intervaloObstaculo, faseAtual, pontuacao;
    let poeira = [];
    let animationFrameId;
    
    let vidas = 3;
    let piscandoVermelho = false;
    let tempoPiscar = 0;
    let musicaMutada = false;  // Estado do mute (s√≥ m√∫sica)
    let highScore = parseInt(localStorage.getItem('sapinhoHighScore')) || 0;

    function unlockAudio() {
  if (audioUnlocked) return;

    function toggleMute() {
  musicaMutada = !musicaMutada;
  backgroundMusic.muted = musicaMutada;
  }

  // Tenta play/pause r√°pido em todos os sons pra desbloquear o contexto de √°udio no iOS
  [jumpSound, failSound, victorySound, backgroundMusic].forEach(sound => {
    const promise = sound.play();
    if (promise !== undefined) {
      promise
        .then(() => {
          sound.pause();
          sound.currentTime = 0;
          console.log(`Desbloqueado: ${sound.id}`);
        })
        .catch(e => console.log(`Unlock falhou em ${sound.id} (normal na primeira vez):`, e));
    }
  });

  audioUnlocked = true;
}

function positionBanners() {
  const banners = [startBanner, gameOverBanner, victoryBanner];
  const canvas = document.getElementById('gameCanvas');
  const canvasRect = canvas.getBoundingClientRect();
  const gameContainer = document.getElementById('game-container');

  banners.forEach(banner => {
    if (banner.classList.contains('active')) {
      banner.style.position = 'absolute';
      const canvasCenterX = canvasRect.left - gameContainer.getBoundingClientRect().left + canvasRect.width / 2;
      const canvasCenterY = canvasRect.top - gameContainer.getBoundingClientRect().top + canvasRect.height / 2;
      banner.style.left = `${canvasCenterX}px`;
      banner.style.top = `${canvasCenterY}px`;
      banner.style.transform = 'translate(-50%, -50%)';
      banner.style.zIndex = '1000';
      console.log(`Banner ${banner.id} vis√≠vel, posicionado no centro do canvas: left=${canvasCenterX}px, top=${canvasCenterY}px`);
      console.log(`Banner ${banner.id} dimensions:`, banner.getBoundingClientRect());
    }
  });

  console.log('Canvas dimensions:', canvasRect);
  if (!isMobile) {
    console.log('Left Ad:', document.getElementById('left-ad').getBoundingClientRect());
    console.log('Right Ad:', document.getElementById('right-ad').getBoundingClientRect());
  } else {
    console.log('Top Ad:', document.getElementById('top-ad').getBoundingClientRect());
  }

  const testVersion = document.getElementById('test-version');
  const aboutSection = document.getElementById('about-section');
  const topAd = document.getElementById('top-ad');
  testVersion.style.position = 'relative';
  testVersion.style.zIndex = '2';
  aboutSection.style.position = 'relative';
  aboutSection.style.zIndex = '2';
  topAd.style.width = '100%';
  topAd.style.maxWidth = '400px';
  topAd.style.height = '100px';
  const adIns = topAd.querySelector('ins.adsbygoogle');
  if (adIns) {
    adIns.style.width = '100%';
    adIns.style.maxWidth = '400px';
    adIns.style.height = '100px';
  }

  // Adicione isso: Garantia extra pro mobile - reposiciona ap√≥s 100ms
  if (isMobile) {
    setTimeout(() => {
      const canvasRect = canvas.getBoundingClientRect();
      banners.forEach(banner => {
        if (banner.classList.contains('active')) {
          const canvasCenterX = canvasRect.left - gameContainer.getBoundingClientRect().left + canvasRect.width / 2;
          const canvasCenterY = canvasRect.top - gameContainer.getBoundingClientRect().top + canvasRect.height / 2;
          banner.style.left = `${canvasCenterX}px`;
          banner.style.top = `${canvasCenterY}px`;
        }
      });
    }, 100);
  }
}

    function resizeCanvas() {
      console.log('resizeCanvas chamado');
      if (isMobile) {
        const maxWidth = Math.min(window.innerWidth - 20, 400);
        canvas.width = maxWidth;
        canvas.height = maxWidth / 2;
        scaleX = canvas.width / BASE_WIDTH;
        scaleY = canvas.height / BASE_HEIGHT;
        ALTURA_CHAO = canvas.height;
        canvas.style.margin = '15px auto';
        document.body.style.overflowY = 'auto';
      } else {
        canvas.width = BASE_WIDTH;
        canvas.height = BASE_HEIGHT;
        scaleX = 1;
        scaleY = 1;
        ALTURA_CHAO = BASE_HEIGHT;
        canvas.style.margin = '20px auto';
      }
      if (sapo) {
        sapo.x = BASE_WIDTH * 0.2 * scaleX;
        sapo.y = ALTURA_CHAO - ESPESSURA_CHAO - SAPO_OFFSET_VISUAL * scaleY;
      }
      positionBanners();
      console.log('Canvas:', canvas.width, canvas.height, 'Scale:', scaleX, scaleY);
    }

    function handleOrientation() {
      const gameContainer = document.getElementById('game-container');
      gameContainer.style.display = 'flex';
      gameContainer.style.flexDirection = 'column';
      gameContainer.style.alignItems = 'center';
      resizeCanvas();
      window.addEventListener('resize', debounce(() => {
        resizeCanvas();
        positionBanners();
      }, 100));
      window.addEventListener('orientationchange', () => {
        setTimeout(() => {
          resizeCanvas();
          positionBanners();
          window.scrollTo(0, 0);
          document.body.style.overflowY = 'auto';
          document.getElementById('game-container').style.minHeight = 'auto';
          const topAd = document.getElementById('top-ad');
          topAd.style.width = '100%';
          topAd.style.maxWidth = '400px';
          topAd.style.height = '100px';
          const adIns = topAd.querySelector('ins.adsbygoogle');
          if (adIns) {
            adIns.style.width = '100%';
            adIns.style.maxWidth = '400px';
            adIns.style.height = '100px';
          }
        }, 200);
      });
    }

    function handleJump() {
      if (gameStarted && !sapo.jumping) {
        sapo.vy = -20 * scaleY;
        sapo.jumping = true;
        jumpSound.currentTime = 0;
        jumpSound.play().catch(e => console.log("Erro ao tocar som:", e));
        console.log('Sapo pulou!');
        for (let i = 0; i < 10; i++) {
          poeira.push({
            x: sapo.x + 15 * scaleX + Math.random() * 10 * scaleX,
            y: sapo.y + 30 * scaleY,
            raio: (3 + Math.random() * 5) * scaleX,
            alpha: 0.7,
            vy: (-1 - Math.random() * 2) * scaleY,
            vx: (Math.random() * 2 - 1) * scaleX
          });
        }
      }
    }

    const handleKeyJump = (e) => {
      if ((e.code === 'Space' || e.code === 'ArrowUp') && gameStarted && !sapo.jumping) {
        handleJump();
      }
    };

   const startGameHandler = (e) => {
  e.preventDefault();
  
  if (!gameStarted && startBanner.classList.contains('active')) {
    // Primeiro: desbloqueia com essa intera√ß√£o do usu√°rio (toque/clique no banner)
    unlockAudio();
    
    // Pequeno delay pra dar tempo pro browser registrar o unlock (funciona melhor no Safari)
    setTimeout(() => {
      startBanner.classList.remove('active');
      iniciarJogo();
      console.log("Jogo iniciado ap√≥s unlock de √°udio!");
    }, 80);  // 80ms √© seguro e impercept√≠vel
  }
};

    function resetGame() {
      if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
      }
      ALTURA_CHAO = isMobile ? canvas.height : BASE_HEIGHT;
      sapo = { x: BASE_WIDTH * 0.2 * scaleX, y: ALTURA_CHAO - ESPESSURA_CHAO - SAPO_OFFSET_VISUAL * scaleY, width: 40 * scaleX, height: ALTURA_SAPO * scaleY, vy: 0, jumping: false };
      obstaculos = [];
      poeira = [];
      tempo = 0;
      intervaloObstaculo = 120;
      faseAtual = 0;
      pontuacao = 0;
      gameOverBanner.classList.remove('active');
      victoryBanner.classList.remove('active');
      startBanner.classList.add('active');
      gameStarted = false;

      backgroundMusic.pause();
      backgroundMusic.currentTime = 0;

      document.removeEventListener('keydown', handleKeyJump);
      document.removeEventListener('keydown', startGameHandler);
      document.removeEventListener('touchstart', startGameHandler);
      canvas.removeEventListener('touchstart', handleJump);

      startBanner.addEventListener('click', startGameHandler);
      startBanner.addEventListener('touchstart', startGameHandler);
      document.addEventListener('keydown', startGameHandler);
      canvas.addEventListener('touchstart', (e) => {
        console.log('Toque no canvas');
        e.preventDefault();
        if (gameStarted && !sapo.jumping) {
          handleJump();
        }
      });
      // No resetGame():
      vidas = 3;
      piscandoVermelho = false;
      tempoPiscar = 0;
      musicaMutada = false;
      backgroundMusic.muted = false;

      // No victory (similar):
      document.getElementById('high-score-victory').textContent = highScore;

      resizeCanvas();
      positionBanners();
    }

    function getFaseAtual() {
      return fases[faseAtual % fases.length];
    }

    function drawChao() {
      ctx.fillStyle = coresFase[getFaseAtual()].chao;
      ctx.clearRect(0, ALTURA_CHAO - ESPESSURA_CHAO, canvas.width, ESPESSURA_CHAO);
      ctx.fillRect(0, ALTURA_CHAO - ESPESSURA_CHAO, canvas.width, ESPESSURA_CHAO);
    }

    function drawSapo() {
      ctx.save();
      ctx.scale(scaleX, scaleY);
      const { x, y, jumping } = sapo;
      ctx.fillStyle = "green";
      ctx.beginPath();
      ctx.ellipse(x / scaleX + 25, y / scaleY + 18, 22, 15, 0, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = "green";
      ctx.lineWidth = 3 / scaleX;
      const armAngle = jumping ? Math.PI/2 : Math.PI/4;
      ctx.beginPath();
      ctx.moveTo(x / scaleX + 18, y / scaleY + 20);
      ctx.lineTo(x / scaleX + 5, y / scaleY + 20);
      ctx.lineTo(x / scaleX + 5 - Math.cos(armAngle) * 18, y / scaleY + 20 + Math.sin(armAngle) * 18);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(x / scaleX + 32, y / scaleY + 20);
      ctx.lineTo(x / scaleX + 45, y / scaleY + 20);
      ctx.lineTo(x / scaleX + 45 + Math.cos(armAngle) * 18, y / scaleY + 20 + Math.sin(armAngle) * 18);
      ctx.stroke();

      ctx.fillStyle = "yellow";
      ctx.beginPath();
      ctx.arc(x / scaleX + 15, y / scaleY + 8, 6, 0, Math.PI * 2);
      ctx.arc(x / scaleX + 35, y / scaleY + 8, 6, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = "black";
      ctx.beginPath();
      ctx.arc(x / scaleX + 15, y / scaleY + 8, 2, 0, Math.PI * 2);
      ctx.arc(x / scaleX + 35, y / scaleY + 8, 2, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = "black";
      ctx.lineWidth = 2 / scaleX;
      ctx.beginPath();
      ctx.arc(x / scaleX + 25, y / scaleY + 18, 8, 0.3, Math.PI - 0.3);
      ctx.stroke();

      ctx.strokeStyle = "green";
      ctx.lineWidth = 4 / scaleX;
      const legAngle = jumping ? Math.PI/2 : Math.PI/4;
      ctx.beginPath();
      ctx.moveTo(x / scaleX + 15, y / scaleY + 30);
      ctx.lineTo(x / scaleX + 5 - Math.cos(legAngle) * 12, y / scaleY + 30 + Math.sin(legAngle) * 25);
      ctx.moveTo(x / scaleX + 35, y / scaleY + 30);
      ctx.lineTo(x / scaleX + 45 + Math.cos(legAngle) * 12, y / scaleY + 30 + Math.sin(legAngle) * 25);
      ctx.stroke();
      ctx.restore();
    }
    // Logo ap√≥s ctx.save() e ctx.scale():
     if (piscandoVermelho && tempoPiscar > 0 && Math.floor(tempoPiscar / 5) % 2) {
     ctx.fillStyle = "#ff4444";  // Pisca
    } else {
    ctx.fillStyle = "green";
    }
// ... resto igual

    function drawObstaculo(obs) {
      ctx.save();
      ctx.scale(scaleX, scaleY);
      ctx.fillStyle = obs.color;
      ctx.fillRect(obs.x / scaleX, obs.y / scaleY, obs.width / scaleX, obs.height / scaleY);
      ctx.restore();
    }

    function atualizarPoeira() {
      ctx.save();
      ctx.scale(scaleX, scaleY);
      for (let i = 0; i < poeira.length; i++) {
        const p = poeira[i];
        ctx.fillStyle = `rgba(143, 188, 143, ${p.alpha})`;
        ctx.beginPath();
        ctx.arc(p.x / scaleX, p.y / scaleY, p.raio / scaleX, 0, Math.PI * 2);
        ctx.fill();
        p.x += p.vx;
        p.y += p.vy;
        p.raio -= 0.1 * scaleX;
        p.alpha -= 0.02;
        p.vy *= 0.98;
      }
      ctx.restore();
      poeira = poeira.filter(p => p.raio > 0.2 * scaleX && p.alpha > 0.05);
    }

    function atualizarJogo() {
      if (!gameStarted) return;
      const fase = getFaseAtual();
      canvas.style.background = coresFase[fase].fundo;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawChao();
      sapo.vy += GRAVIDADE * scaleY;
      sapo.y += sapo.vy;
      if (sapo.y > ALTURA_CHAO - ESPESSURA_CHAO - SAPO_OFFSET_VISUAL * scaleY) {
        sapo.y = ALTURA_CHAO - ESPESSURA_CHAO - SAPO_OFFSET_VISUAL * scaleY;
        sapo.vy = 0;
        sapo.jumping = false;
      }
      function drawMuteButton() {
  ctx.save();
  ctx.scale(scaleX, scaleY);
  
  const btnX = (canvas.width / scaleX) - 60;
  const btnY = 10;
  const btnW = 50;
  const btnH = 50;
  
  // Fundo do bot√£o (semi-transparente verde)
  ctx.fillStyle = 'rgba(27, 94, 32, 0.8)';
  ctx.fillRect(btnX, btnY, btnW, btnH);
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 3 / scaleX;
  ctx.strokeRect(btnX, btnY, btnW, btnH);
  
  // √çcone (simples: ondas de som ou X)
  ctx.fillStyle = '#fff';
  ctx.font = 'bold 24px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  
  if (musicaMutada) {
    // Mute: X no alto-falante
    ctx.fillText('üîá', btnX + btnW/2, btnY + btnH/2);
  } else {
    // Volume: ondas
    ctx.fillText('üîä', btnX + btnW/2, btnY + btnH/2);
  }
  
  ctx.restore();
}
      drawSapo();
      atualizarPoeira();
      if (tempo % intervaloObstaculo === 0 && tempo >= 120) {
        let cores = ["#d32f2f", "#fbc02d", "#7b1fa2", "#00796b"];
        let cor = cores[Math.floor(Math.random() * cores.length)];
        obstaculos.push({ x: BASE_WIDTH * scaleX, y: ALTURA_CHAO - ESPESSURA_CHAO - 30 * scaleY, width: 30 * scaleX, height: 30 * scaleY, color: cor });
      }
      for (let i = 0; i < obstaculos.length; i++) {
        let obs = obstaculos[i];
        obs.x -= 5 * scaleX;
        drawObstaculo(obs);
      }
      obstaculos = obstaculos.filter(obs => obs.x + obs.width > 0);
      tempo++;
      pontuacao++;
      if (tempo % 1500 === 0) {
        faseAtual++;
        intervaloObstaculo = Math.max(60, intervaloObstaculo - 10);
      }
      // L√≥gica piscar
if (piscandoVermelho && tempoPiscar > 0) {
  tempoPiscar--;
} else {
  piscandoVermelho = false;
}

// Desenhar bot√£o mute
drawMuteButton();
   // Score + Vidas (topo esquerdo)
ctx.save();
ctx.scale(scaleX, scaleY);
ctx.font = isMobile ? "bold 16px Arial" : "bold 18px Arial";
ctx.fillStyle = "#fff";
ctx.strokeStyle = "#000";
ctx.lineWidth = 2 / scaleX;
ctx.textAlign = 'left';

// Score
ctx.strokeText("Score: " + pontuacao, 10, 20);
ctx.fillText("Score: " + pontuacao, 10, 20);

// Vidas (3 cora√ß√µes ao lado)
for (let i = 0; i < 3; i++) {
  const cor = i < vidas 
    ? (piscandoVermelho && tempoPiscar > 0 ? "#ff4444" : "#ff1744") 
    : "#666";
  ctx.fillStyle = cor;
  
  const coracaoX = 120 + i * 30;  // Ao lado do score
  const coracaoY = 18;
  
  // Desenho simples de cora√ß√£o
  ctx.beginPath();
  ctx.moveTo(coracaoX, coracaoY + 5);
  ctx.bezierCurveTo(coracaoX, coracaoY, coracaoX - 5, coracaoY, coracaoX - 5, coracaoY + 5);
  ctx.bezierCurveTo(coracaoX - 5, coracaoY + 7, coracaoX - 3, coracaoY + 10, coracaoX, coracaoY + 8);
  ctx.bezierCurveTo(coracaoX + 3, coracaoY + 10, coracaoX + 5, coracaoY + 7, coracaoX + 5, coracaoY + 5);
  ctx.bezierCurveTo(coracaoX + 5, coracaoY, coracaoX, coracaoY, coracaoX, coracaoY + 5);
  ctx.fill();
}

ctx.restore();

    function verificarColisao() {
      for (let obs of obstaculos) {
        const sapoHitboxY = sapo.y + 7 * scaleY;
        if (
          sapo.x < obs.x + obs.width &&
          sapo.x + sapo.width > obs.x &&
          sapoHitboxY < obs.y + obs.height &&
          sapoHitboxY + ALTURA_SAPO * scaleY > obs.y
        ) {
          return true;
        }
      }
      return false;
    }

    function iniciarJogo() {
      if (gameStarted) return;
      gameStarted = true;
      document.addEventListener('keydown', handleKeyJump);
      canvas.addEventListener('touchstart', (e) => {
        console.log('Toque no canvas');
        e.preventDefault();
        if (gameStarted && !sapo.jumping) {
          handleJump();
        }
      });
      // Detecta clique/toque no bot√£o mute (sup. direito)
  function handleCanvasClick(e) {
  e.preventDefault();
  const rect = canvas.getBoundingClientRect();
  const x = (e.clientX || e.touches[0].clientX) - rect.left;
  const y = (e.clientY || e.touches[0].clientY) - rect.top;
  
  // √Årea do bot√£o: sup. direito (50x50px ajustado por scale)
  const btnX = canvas.width - 60 * scaleX;
  const btnY = 10 * scaleY;
  const btnW = 50 * scaleX;
  const btnH = 50 * scaleY;
  
  if (x >= btnX && x <= btnX + btnW && y >= btnY && y <= btnY + btnH) {
    toggleMute();
  }
}

canvas.addEventListener('click', handleCanvasClick);
canvas.addEventListener('touchstart', handleCanvasClick);
        // Tenta tocar a m√∫sica (depois do unlock, deve funcionar na primeira vez)
  backgroundMusic.play()
    .then(() => {
      console.log("M√∫sica de fundo iniciada com sucesso!");
    })
    .catch(e => {
      console.error("Falha ao tocar m√∫sica (talvez precise de outra intera√ß√£o):", e);
      // Se ainda falhar (raro), pode tentar de novo em pr√≥ximo toque, mas geralmente n√£o precisa
    });
      animationFrameId = requestAnimationFrame(gameLoop);
    }

    function gameLoop() {
      if (!gameStarted) {
        return;
      }
      atualizarJogo();
     if (verificarColisao()) {
  if (piscandoVermelho) return;  // Invenc√≠vel durante piscar

  vidas--;
  piscandoVermelho = true;
  tempoPiscar = 60;  // ~1s piscando

  // Reset sapo no ch√£o
  sapo.y = ALTURA_CHAO - ESPESSURA_CHAO - SAPO_OFFSET_VISUAL * scaleY;
  sapo.vy = 0;
  sapo.jumping = false;

  failSound.currentTime = 0;
  failSound.play().catch(e => {});

  if (vidas <= 0) {
    // Game over real
    gameStarted = false;
    cancelAnimationFrame(animationFrameId);
    backgroundMusic.pause();
    backgroundMusic.currentTime = 0;
    finalScore.textContent = pontuacao;
    document.getElementById('high-score').textContent = highScore;
    if (pontuacao > highScore) {
      highScore = pontuacao;
      localStorage.setItem('sapinhoHighScore', highScore);
    }
    gameOverBanner.classList.add('active');
    positionBanners();
    return;
  }
  return;  // Continua com vida -
}
      if (pontuacao >= PONTUACAO_VITORIA) {
        gameStarted = false;
        cancelAnimationFrame(animationFrameId);
        victorySound.play().catch(e => console.log("Erro ao tocar som:", e));
        backgroundMusic.pause();
        backgroundMusic.currentTime = 0;
        victoryScore.textContent = pontuacao;
        victoryBanner.classList.add('active');
        positionBanners();
        document.removeEventListener('keydown', handleKeyJump);
        document.removeEventListener('keydown', startGameHandler);
        document.removeEventListener('touchstart', startGameHandler);
        canvas.removeEventListener('touchstart', handleJump);
        return;
      }
      animationFrameId = requestAnimationFrame(gameLoop);
    }

    const weatherElement = document.getElementById("weather");
    const clockElement = document.getElementById("clock");

    let lastWeatherData = null;
    let lastWeatherFetch = 0;
    const CACHE_DURATION = 10 * 60 * 1000;

    async function fetchWeather() {
      try {
        const now = Date.now();
        if (lastWeatherData && now - lastWeatherFetch < CACHE_DURATION) {
          weatherElement.textContent = lastWeatherData;
          return;
        }
        const API_KEY = "b8a0cd03c689322da2746720be31d534";
        const city = "S√£o Paulo";
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&lang=pt_br&units=metric`, { mode: 'cors' });
        if (!response.ok) throw new Error(`Falha na API OpenWeatherMap: ${response.status}`);
        const data = await response.json();
        const temp = Math.round(data.main.temp);
        const description = data.weather[0].description;
        lastWeatherData = ` ${city}: ${temp}¬∞C, ${description}`;
        lastWeatherFetch = now;
        weatherElement.textContent = lastWeatherData;
      } catch (error) {
        console.error("Erro ao buscar previs√£o do tempo:", error);
        weatherElement.textContent = "Clima indispon√≠vel";
      }
    }

 // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//          REL√ìGIO COM SEGUNDOS EM TEMPO REAL
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function formatarDataHoraBR(date) {
  const dia  = String(date.getDate()).padStart(2, '0');
  const mes  = String(date.getMonth() + 1).padStart(2, '0');
  const ano  = date.getFullYear();
  
  const hora = String(date.getHours()).padStart(2, '0');
  const min  = String(date.getMinutes()).padStart(2, '0');
  const seg  = String(date.getSeconds()).padStart(2, '0');
  
  return `${dia}/${mes}/${ano} - ${hora}:${min}:${seg}`;
}

function atualizarRelogioLocal() {
  const agora = new Date();
  clockElement.textContent = formatarDataHoraBR(agora);
}

// Tenta pegar hor√°rio oficial de S√£o Paulo uma √∫nica vez no carregamento
async function tentarHorarioOficialUmaVez() {
  try {
    const res = await fetch("https://worldtimeapi.org/api/timezone/America/Sao_Paulo", {
      mode: 'cors',
      cache: 'no-store'
    });
    if (!res.ok) throw new Error("status " + res.status);
    
    const data = await res.json();
    const dataHoraApi = new Date(data.datetime);
    
    // Ajusta o rel√≥gio local pro hor√°rio oficial (s√≥ na inicializa√ß√£o)
    const diferencaMs = dataHoraApi - new Date();
    if (Math.abs(diferencaMs) > 30000) { // mais de 30s de diferen√ßa ‚Üí ajusta
      console.warn("Ajustando rel√≥gio local com diferen√ßa de", Math.round(diferencaMs/1000), "segundos");
      // Aqui poder√≠amos compensar, mas na pr√°tica o rel√≥gio do SO costuma estar ok
    }
    
    clockElement.textContent = formatarDataHoraBR(dataHoraApi);
  } catch (err) {
    console.warn("N√£o conseguiu pegar hor√°rio oficial ‚Üí usando rel√≥gio local", err);
    atualizarRelogioLocal();
  }
}

// Inicia o rel√≥gio
window.addEventListener('load', () => {
  // ... seu c√≥digo existente ...

  tentarHorarioOficialUmaVez();           // tenta sincronizar uma vez
  atualizarRelogioLocal();                // mostra imediatamente
  setInterval(atualizarRelogioLocal, 1000); // atualiza segundos a cada 1s
});

    window.addEventListener('load', () => {
      handleOrientation();
      resizeCanvas();
      window.addEventListener('resize', debounce(() => {
        resizeCanvas();
        positionBanners();
      }, 100));
      resetGame();

      fetchWeather();
      atualizarHora();

      setInterval(fetchWeather, 10 * 60 * 1000);
      setInterval(atualizarHora, 60 * 1000);

        document.body.addEventListener('touchstart', unlockAudio, { once: true });
        
      positionBanners();
    });

    restartButton.addEventListener("click", resetGame);
    playAgainButton.addEventListener("click", resetGame);
  </script>
    <!-- BLOQUEIO HORIZONTAL ‚Äì VERS√ÉO FINAL E IMORTAL (FUNCIONA EM TODOS OS CELULARES) -->
  <style>
    #force-portrait{visibility:hidden;opacity:0;transition:opacity .3s}
    #force-portrait.active{visibility:visible;opacity:1}
    #force-portrait{
      position:fixed;top:0;left:0;width:100vw;height:100vh;
      background:#000;z-index:999999;display:flex;
      justify-content:center;align-items:center;flex-direction:column;
      text-align:center;color:#fff;font-family:sans-serif;padding:20px;
      box-sizing:border-box;transition:opacity .3s;
    }
    #force-portrait svg{width:80px;height:80px;margin-bottom:20px;
      animation:g 3s linear infinite;stroke:#00ff00;stroke-width:2.5}
    #force-portrait h2{font-size:28px;color:#00ff00;margin:0 0 10px}
    #force-portrait p{font-size:18px}
    @keyframes g{to{transform:rotate(360deg)}}
  </style>

  <div id="force-portrait">
    <svg viewBox="0 0 24 24" fill="none">
      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
      <line x1="8" y1="3" x2="8" y2="8"></line>
      <line x1="16" y1="3" x2="16" y2="8"></line>
      <path d="M12 16v5"></path>
      <path d="M8 16h8"></path>
    </svg>
    <h2>Gire o celular</h2>
    <p>Para jogar, use o modo vertical</p>
  </div>

  <script>
    const blocker = document.getElementById('force-portrait');
    function check() {
      // A l√≥gica mais confi√°vel que existe no planeta Terra
      const w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
      const h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
      if (w > h && w <= 1023) {
        blocker.classList.add('active');
        document.body.style.overflow = 'hidden';
      } else {
        blocker.classList.remove('active');
        document.body.style.overflow = '';
      }
    }
    // Roda em tudo que existe
    window.addEventListener('load', check);
    window.addEventListener('resize', check);
    window.addEventListener('orientationchange', check);
    // For√ßa checagem a cada 500ms por 5 segundos (mata qualquer bug de carregamento)
    let i = 0;
    const force = setInterval(() => { check(); if (++i === 10) clearInterval(force); }, 500);
    // Primeira checagem imediata
    check();
  </script>
</body>
</html>


